<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jimi Hendrix Room</title>

<style>
:root{
  --bg:#1a1625;
  --panel:#2a2340;
  --muted:#b7a9d6;
  --accent:#8b6cff;
  --text:#e6ddff;
  --shadow:rgba(0,0,0,0.65);
}
html,body{
  height:100%;margin:0;
  font-family: Georgia, serif;
  background:var(--bg);
  color:var(--text);
}
#wrap{
  display:flex;
  gap:12px;
  padding:12px;
}
canvas{
  background:var(--panel);
  border-radius:10px;
  image-rendering:pixelated;
  box-shadow:0 0 15px var(--shadow);
  border:2px solid var(--accent);
}
#ui{
  width:320px;
  padding:20px;
  background:linear-gradient(180deg,#2a2340,#1a1625);
  border-radius:10px;
}
#ui h2{
  font-family:"Courier New",monospace;
  color:var(--accent);
  letter-spacing:2px;
}
#ui p{color:var(--muted)}

/* ===== MODAL ===== */
.modal{
  position:fixed; inset:0;
  background:rgba(26,22,37,.95);
  display:none; align-items:center; justify-content:center;
  z-index:10;
}
.modal.visible{display:flex}
.modalBox{
  width:620px; max-width:94%;
  background:linear-gradient(180deg,#2a2340,#1a1625);
  border:3px solid var(--accent);
  border-radius:16px;
  padding:24px;
  box-shadow:0 20px 50px var(--shadow);
}
.modalBox h3{
  margin-top:0;
  font-family:"Courier New",monospace;
  color:var(--accent);
  letter-spacing:1px;
}
.modalBox button{
  margin-top:14px;
  padding:10px 20px;
  background:var(--accent);
  border:none;
  border-radius:6px;
  font-family:"Courier New",monospace;
  cursor:pointer;
}

/* ===== PLAYLIST ===== */
.playlist{margin-top:16px}
.track{
  margin-bottom:18px;
  padding-bottom:10px;
  border-bottom:1px solid rgba(183,169,214,.3);
}
.track-title{
  font-family:"Courier New",monospace;
  font-size:.9em;
  letter-spacing:1px;
  color:var(--muted);
  margin-bottom:6px;
  text-transform:uppercase;
}
.track audio{
  width:100%;
  filter:sepia(25%) brightness(90%);
}
</style>
</head>

<body>
<div id="wrap">
  <canvas id="game" width="960" height="540"></canvas>
  <div id="ui">
    <h2>Jimi Hendrix</h2>
    <p>E = interact<br>ESC = exit room</p>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modalBox" id="modalBox"></div>
</div>

<script>
/* ================= BASIC SETUP ================= */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
ctx.imageSmoothingEnabled=false;

const GRAV=0.36, GROUND_Y=520;

/* ================= PLAYER ================= */
const player={
  x:80,y:520,w:250,h:250,
  vx:0,vy:0,speed:3.4,jump:9,
  onGround:true,facing:1,
  anim:"idle",frame:0,frameTimer:0,frameSpeed:6
};

const SPRITE_FRAME_W=1400, SPRITE_FRAME_H=1400;
const animImages={
  idle:new Image(),
  walk:[new Image(),new Image()],
  jump:new Image()
};
animImages.idle.src="../assets/sprites/player_idle.png";
animImages.walk[0].src="../assets/sprites/player_walk1.png";
animImages.walk[1].src="../assets/sprites/player_walk2.png";
animImages.jump.src="../assets/sprites/player_jump.png";

/* ================= ROOM ================= */
const ROOM={
  background:"assets/images/jimi_room.png",
  exhibits:[
    {x:150,y:300,w:140,h:200,type:"info"},
    {x:420,y:300,w:120,h:160,type:"discography"},
    {x:750,y:300,w:140,h:200,type:"playlist"}
  ]
};

/* ================= INPUT ================= */
const keys={};
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* ================= MODAL ================= */
const modal=document.getElementById("modal");
const modalBox=document.getElementById("modalBox");
function openModal(html){modalBox.innerHTML=html;modal.classList.add("visible")}
function closeModal(){modal.classList.remove("visible")}

/* ===== PLAYLIST LOGIC ===== */
function setupPlaylistControls(){
  const audios=document.querySelectorAll(".playlist audio");
  audios.forEach(a=>{
    a.addEventListener("play",()=>{
      audios.forEach(o=>{
        if(o!==a){o.pause();o.currentTime=0;}
      });
    });
  });
}

/* ================= INTERACTION ================= */
function findNearby(){
  for(const ex of ROOM.exhibits){
    const px=player.x+player.w/2;
    const py=player.y-player.h/2;
    if(Math.abs(px-(ex.x+ex.w/2))<90 && Math.abs(py-(ex.y+ex.h/2))<90) return ex;
  }
  return null;
}

function interact(ex){
  if(ex.type==="playlist"){
    openModal(`
      <h3>Jimi Hendrix Playlist</h3>
      <div class="playlist">
        <div class="track">
          <div class="track-title">Purple Haze</div>
          <audio controls src="../assets/audio/jimi_purple_haze.mp3"></audio>
        </div>
        <div class="track">
          <div class="track-title">Little Wing</div>
          <audio controls src="../assets/audio/jimi_little_wing.mp3"></audio>
        </div>
        <div class="track">
          <div class="track-title">All Along the Watchtower</div>
          <audio controls src="../assets/audio/jimi_watchtower.mp3"></audio>
        </div>
      </div>
      <button onclick="closeModal()">Close</button>
    `);
    setTimeout(setupPlaylistControls,0);
  } else if(ex.type==="info"){
    openModal(`
      <h3>Jimi Hendrix</h3>
      <p>
        ÎŸ Jimi Hendrix (1942-1970) Î¸ÎµÏ‰ÏÎµÎ¯Ï„Î±Î¹ Î­Î½Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ Ï€Î¹Î¿ ÎµÏ€Î¹Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ¿ÏÏ‚ ÎºÎ¹Î¸Î±ÏÎ¯ÏƒÏ„ÎµÏ‚ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏÎ¯Î± Ï„Î·Ï‚ ÏÎ¿Îº Î¼Î¿Ï…ÏƒÎ¹ÎºÎ®Ï‚. Î“ÎµÎ½Î½Î®Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Î£Î¹Î¬Ï„Î» Ï„Ï‰Î½ Î—Î Î‘ ÎºÎ±Î¹ Î±Ï€ÏŒ Î¼Î¹ÎºÏÎ® Î·Î»Î¹ÎºÎ¯Î± Î­Î´ÎµÎ¹Î¾Îµ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ¿ Ï„Î±Î»Î­Î½Ï„Î¿ ÏƒÏ„Î·Î½ ÎºÎ¹Î¸Î¬ÏÎ±. Î— Î¼Î¿Ï…ÏƒÎ¹ÎºÎ® Ï„Î¿Ï… ÏƒÏ…Î½Î´ÏÎ±Î¶Îµ ÏÎ¿Îº, Î¼Ï€Î»Î¿Ï…Î¶ ÎºÎ±Î¹ ÏˆÏ…Ï‡ÎµÎ´ÎµÎ»Î¹ÎºÏŒ Î®Ï‡Î¿, ÎºÎ±Î¹ Î®Ï„Î±Î½ Ï€ÏÏ‰Ï„Î¿Ï€ÏŒÏÎ¿Ï‚ ÏƒÏ„Î· Ï‡ÏÎ®ÏƒÎ· Î·Î»ÎµÎºÏ„ÏÎ¹ÎºÏÎ½ ÎµÏ†Î­ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ feedback ÎºÎ±Î¹ Ï„Î¿ wah-wah. Î— ÎºÎ±ÏÎ¹Î­ÏÎ± Ï„Î¿Ï…, Î±Î½ ÎºÎ±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î·, Î®Ï„Î±Î½ Î³ÎµÎ¼Î¬Ï„Î· ÎºÎ±Î¹Î½Î¿Ï„Î¿Î¼Î¯ÎµÏ‚ Ï€Î¿Ï… Î¬Î»Î»Î±Î¾Î±Î½ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ Ï€Î¿Ï… Ï€Î±Î¹Î¶ÏŒÏ„Î±Î½ Î· Î·Î»ÎµÎºÏ„ÏÎ¹ÎºÎ® ÎºÎ¹Î¸Î¬ÏÎ±. Î— Î¶Ï‰Î½Ï„Î±Î½Î® Ï„Î¿Ï… Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î±, Î³ÎµÎ¼Î¬Ï„Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎºÎ±Î¹ Ï€Î¬Î¸Î¿Ï‚, Ï„Î¿Î½ Î­ÎºÎ±Î½Îµ Î¸ÏÏÎ»Î¿. Î Î­Î¸Î±Î½Îµ ÏƒÎµ Î·Î»Î¹ÎºÎ¯Î± Î¼ÏŒÎ»Î¹Ï‚ 27 ÎµÏ„ÏÎ½, Î±Ï†Î®Î½Î¿Î½Ï„Î±Ï‚ ÏŒÎ¼Ï‰Ï‚ Ï„ÎµÏÎ¬ÏƒÏ„Î¹Î± ÎºÎ»Î·ÏÎ¿Î½Î¿Î¼Î¹Î¬.
      </p>
      <button onclick="closeModal()">Close</button>
    `);
  } else if(ex.type==="discography"){
    openModal(`
      <h3>Discography</h3>
      <ul>
        <li>Are You Experienced (1967): Î¤Î¿ Î½Ï„ÎµÎ¼Ï€Î¿ÏÏ„Î¿ Î¬Î»Î¼Ï€Î¿Ï…Î¼ Ï€Î¿Ï… Î­Î¸ÎµÏƒÎµ Î½Î­Î± ÏƒÏ„Î¬Î½Ï„Î±Ï ÏƒÏ„Î·Î½ ÏÎ¿Îº Î¼Î¿Ï…ÏƒÎ¹ÎºÎ®, Î¼Îµ ÎºÎ»Î±ÏƒÎ¹ÎºÎ¬ ÎºÎ¿Î¼Î¼Î¬Ï„Î¹Î± ÏŒÏ€Ï‰Ï‚ "Purple Haze" ÎºÎ±Î¹ "The Wind Cries Mary".</li>
        <li>Axis: Bold as Love (1967): Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ Ï€ÎµÎ¹ÏÎ±Î¼Î±Ï„Î¹ÎºÏŒ ÎºÎ±Î¹ Î¼ÎµÎ»Ï‰Î´Î¹ÎºÏŒ, ÎµÎ¾ÎµÏÎµÏ…Î½Î¬ Î´Î¹Î¬Ï†Î¿ÏÎ± Î¼Î¿Ï…ÏƒÎ¹ÎºÎ¬ Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹Î±.</li>
		<li>Electric Ladyland (1968): Î¤Î¿ Ï€Î¹Î¿ ÎºÎ±Î¹Î½Î¿Ï„ÏŒÎ¼Î¿ ÎºÎ±Î¹ Ï€Î¿Î»Ï…ÏƒÏÎ½Î¸ÎµÏ„Î¿ Î­ÏÎ³Î¿ Ï„Î¿Ï…, Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î±ÏÎ¹ÏƒÏ„Î¿Ï…ÏÎ³Î®Î¼Î±Ï„Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ "Voodoo Child (Slight Return)".</li>
      </ul>
      <button onclick="closeModal()">Close</button>
    `);
    
  }
}


/* ================= UPDATE ================= */
function update(dt){
  let move=0;
  if(keys.a||keys.arrowleft) move=-1;
  if(keys.d||keys.arrowright) move=1;
  player.vx=move*player.speed;
  player.x+=player.vx*dt;

  if(!player.onGround){
    player.vy+=GRAV; player.y+=player.vy*dt;
    if(player.y>=GROUND_Y){player.y=GROUND_Y;player.vy=0;player.onGround=true;}
  }
  if((keys[" "]||keys.space)&&player.onGround){
    player.onGround=false; player.vy=-player.jump;
  }

  if(!player.onGround) player.anim="jump";
  else if(move) player.anim="walk";
  else player.anim="idle";

  if(player.anim==="walk"){
    player.frameTimer+=dt;
    if(player.frameTimer>=player.frameSpeed){
      player.frameTimer=0;
      player.frame=(player.frame+1)%2;
    }
  } else player.frame=0;

  if(move) player.facing=move;

   const near=findNearby();
   if((keys["e"] || keys["Îµ"] || keys["Î•"] || keys["E"]) && near){
    keys["e"] = false;
    keys["Îµ"] = false;
	keys["Î•"] = false;
	keys["E"] = false;
    interact(near);
	}
}

/* ================= DRAW ================= */
const bg=new Image(); bg.src=ROOM.background;
function draw(){
  ctx.drawImage(bg,0,0,960,540);

  const near=findNearby();
  if(near){
    ctx.font="24px monospace";
    ctx.fillStyle="#ffd36a";
    ctx.textAlign="center";
    ctx.shadowColor="rgba(0,0,0,.9)";
    ctx.shadowBlur=8;
    ctx.fillText("ğŸ…” Î Î‘Î¤Î‘ Î•",near.x+near.w/2,near.y-20);
    ctx.shadowBlur=0;
  }

  ctx.save();
  if(player.facing===-1){
    ctx.translate(player.x+player.w/2,0);
    ctx.scale(-1,1);
    ctx.translate(-(player.x+player.w/2),0);
  }

  const img=player.anim==="walk"?animImages.walk[player.frame]:
            player.anim==="jump"?animImages.jump:
            animImages.idle;

  ctx.drawImage(img,0,0,SPRITE_FRAME_W,SPRITE_FRAME_H,
    player.x,player.y-player.h,player.w,player.h);
  ctx.restore();
}

/* ================= LOOP ================= */
let last=performance.now();
function loop(t){
  const dt=(t-last)/16.6; last=t;
  update(dt); draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ================= EXIT ================= */
addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    location.href="../index.html?start=rock_doors&spawn=jimi_room";
  }
});
</script>
</body>
</html>
